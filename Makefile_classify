# Makefile for classify_topology_ext
# Extended version supporting External curves

CXX = g++
CXXFLAGS = -std=c++17 -O3 -Wall -Wextra -march=native
LDFLAGS = -pthread

# Eigen path (adjust if needed)
EIGEN_INCLUDE = -I/usr/include/eigen3

# Your project include paths (adjust to your directory structure)
INCLUDES = -I. -I./include $(EIGEN_INCLUDE)

# Target executable
TARGET = classify_topology_ext

# Source file
SRC = classify_topology_ext.cpp

# Object file
OBJ = $(SRC:.cpp=.o)

# Required header dependencies
HEADERS = Topology_enhanced.h \
          TopologyDB_enhanced.hpp \
          TopoLineCompact_enhanced.hpp \
          Theory_enhanced.h \
          Tensor.h

# Default target
all: $(TARGET)

# Link
$(TARGET): $(OBJ)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(LDFLAGS)
	@echo "Built: $(TARGET)"

# Compile
%.o: %.cpp $(HEADERS)
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# Clean
clean:
	rm -f $(OBJ) $(TARGET)

# Clean all output files as well
cleanall: clean
	rm -f *_IF_SCFT.txt *_IF_LST.txt

# Install (optional - copy to bin directory)
install: $(TARGET)
	cp $(TARGET) ~/bin/

# Help
help:
	@echo "Makefile for classify_topology_ext"
	@echo ""
	@echo "Targets:"
	@echo "  all       - Build the executable (default)"
	@echo "  clean     - Remove object files and executable"
	@echo "  cleanall  - Remove everything including output files"
	@echo "  install   - Copy executable to ~/bin/"
	@echo "  help      - Show this help message"
	@echo ""
	@echo "Usage:"
	@echo "  make"
	@echo "  ./classify_topology_ext <input> <output_dir> [--in line|db|auto]"

.PHONY: all clean cleanall install help
